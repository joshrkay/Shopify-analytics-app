# Shopify App Configuration for Markinsight
# Documentation: https://shopify.dev/docs/apps/tools/cli/configuration

# Shopify CLI identifies this app by client_id (API Key from Partner Dashboard)
client_id = "e10bb8b9705aafdfb3ff2dc5842d39fb"

name = "Markinsight"
handle = "markinsight"
application_url = "https://shopify-analytics-app-pmsl.onrender.com"

# Embedded app configuration
embedded = true

# OAuth scopes are defined in [access_scopes] section below

# Allowed redirect URLs for OAuth flow
[auth]
redirect_urls = [
  "https://shopify-analytics-app-pmsl.onrender.com/api/auth/callback",
  "https://shopify-analytics-app-pmsl.onrender.com/api/billing/callback"
]

# Webhooks configuration
# These match your existing webhook routes in backend/src/api/routes/webhooks_shopify.py
[webhooks]
api_version = "2026-01"

  # App lifecycle webhooks
  [[webhooks.subscriptions]]
  topics = ["app/uninstalled"]
  uri = "/api/webhooks/shopify/app-uninstalled"

  # Billing webhooks
  [[webhooks.subscriptions]]
  topics = ["app_subscriptions/update"]
  uri = "/api/webhooks/shopify/subscription-update"

  # GDPR mandatory webhooks
  [[webhooks.subscriptions]]
  topics = ["customers/redact"]
  uri = "/api/webhooks/shopify/customers-redact"

  [[webhooks.subscriptions]]
  topics = ["shop/redact"]
  uri = "/api/webhooks/shopify/shop-redact"

  [[webhooks.subscriptions]]
  topics = ["customers/data_request"]
  uri = "/api/webhooks/shopify/customers-data-request"

# App distribution settings
[access_scopes]
# OAuth scopes for analytics apps
scopes = "read_orders,read_products,read_customers,read_analytics"
# Use legacy mode for self-hosted apps
use_legacy_install_flow = true

# Build configuration (not used for self-hosted apps, but required by CLI)
[build]
automatically_update_urls_on_dev = false
include_config_on_deploy = true
